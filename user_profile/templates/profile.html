{% extends 'base.html' %}

{% block content %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <div class="text-white my-5 mx-3 text-center">
        <p id="sorting" class="text-5xl text-center mb-0">Bookmarks and Likes</p>
    </div>
    
    <!-- <div id="book_cards" class="text-white mx-3"></div>
    <div id="bookmarked-books"></div>
    <div id="liked-books"></div> -->

    <div class="container">
        <div class="book-list">
            <h2 class="text-xl font-semibold text-white">Bookmarks</h2>
            <div id="bookmarked-books">
                <!-- Bookmark data will be inserted here using AJAX -->
            </div>
        </div>
        <div class="book-list">
            <h2 class="text-xl font-semibold text-white">Likes</h2>
            <div id="liked-books">
                <!-- Liked data will be inserted here using AJAX -->
            </div>
        </div>
    </div>

    <script>
        // // ajax get
        // async function showProfile() {
        //     return fetch("{% url 'show_profile' %}").then((res) => res.json());
        // }

        // // sort by stars. if the stars is equal => ascending by title
        // function compareByRating(a, b) {
        //     if (a.fields.stars == b.fields.stars) {
        //         return b.fields.title.localeCompare(a.fields.title);
        //     }
        //     return a.fields.stars - b.fields.stars;
        // }

        // async function showDetails(pk) {
        //     window.open("book-id-" + pk + "/", "_blank");
        // }
    
        // async function refreshBooks() {
        //     document.getElementById("book_cards").innerHTML = "";           
        //     let htmlString = `<div class="flex items-center justify-content-center container mx-auto my-8">
        //         <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5">`;

        //     const books = await showProfile();
        //     document.getElementById("sorting").innerHTML = `\n<p class="text-center mt-0 text-5xl mb-0">Sorted by Rating</p>`;
        //     // books.sort(compareByRating);
        //     // books.reverse();
            
        //     books['bookmarked_books'].sort(compareByRating);
        //     books['bookmarked_books'].reverse();
        //     books['liked_books'].sort(compareByRating);
        //     books['liked_books'].reverse();
            

        //     // show all bookmarks
        //     for (let i = 0; i < books['bookmarked_books'].length; i++) {
        //         book = books['bookmarked_books'][i];
        //         htmlString += `\n
        //         <div class="rounded-xl shadow-lg bg-zinc-800 relative">
        //             <div class="p-5 flex flex-col">
        //                 <img src="${book.fields.image_link}" alt="Cover for ${book.fields.title}" 
        //                 class="rounded-xl overflow-hidden w-52">
        //                 <p class="text-m md:text-m font-medium mt-3 text-white">
        //                     ${i+1}. ${book.fields.title}
        //                     <br>
        //                     -- ${book.fields.category}
        //                 </p>
        //                 <br>
        //                 <br>
        //                 <button class="text-center bg-gray-600 text-white py-2 rounded-lg font-semibold mt-4 hover:bg-gray-400 
        //                 focus:scale-95 transition-all duration-50 absolute inset-x-3 bottom-3" method="GET" onclick="showDetails(${book.pk})">
        //                     Details
        //                 </button>
        //             </div>
        //         </div>`
        //     }

        //     for (let i = 0; i < books['liked_books'].length; i++) {
        //         book = books['liked_books'][i];
        //         htmlString += `\n
        //         <div class="rounded-xl shadow-lg bg-zinc-800 relative">
        //             <div class="p-5 flex flex-col">
        //                 <img src="${book.fields.image_link}" alt="Cover for ${book.fields.title}" 
        //                 class="rounded-xl overflow-hidden w-52">
        //                 <p class="text-m md:text-m font-medium mt-3 text-white">
        //                     ${i+1}. ${book.fields.title}
        //                     <br>
        //                     -- ${book.fields.category}
        //                 </p>
        //                 <br>
        //                 <br>
        //                 <button class="text-center bg-gray-600 text-white py-2 rounded-lg font-semibold mt-4 hover:bg-gray-400 
        //                 focus:scale-95 transition-all duration-50 absolute inset-x-3 bottom-3" method="GET" onclick="showDetails(${book.pk})">
        //                     Details
        //                 </button>
        //             </div>
        //         </div>`
        //     }
        //     htmlString += `\n</div></div>`;         
        // }
        // document.getElementById("book_cards").innerHTML = htmlString;

        $(document).ready(function() {
            $.ajax({
                url: '{% url "show_profile" %}',  // Use the URL pattern name to access the view
                type: 'GET',
                success: function(data) {
                    // Process the data and update the UI for both bookmarked and liked books
                    displayBooks('bookmarked-books', data.bookmarked_books);
                    displayBooks('liked-books', data.liked_books);
                }
            });

            function displayBooks(containerId, books) {
                var container = $('#' + containerId);
                container.empty();  // Clear the container

                // Loop through the data and create elements to display the books
                for (var i = 0; i < books.length; i++) {
                    var book = books[i];
                    var bookElement = `
                        <div class="rounded-xl shadow-lg bg-zinc-800 relative">
                            <div class="p-5 flex flex-col">
                                <img src="${book.fields.image_link}" alt="Cover for ${book.fields.title}" 
                                class="rounded-xl overflow-hidden w-52">
                                <p class="text-m md:text-m font-medium mt-3 text-white">
                                    ${i + 1}. ${book.fields.title}
                                    <br>
                                    -- ${book.fields.category}
                                </p>
                                <br>
                                <br>
                                <button class="text-center bg-gray-600 text-white py-2 rounded-lg font-semibold mt-4 hover-bg-gray-400 
                                focus:scale-95 transition-all duration-50 absolute inset-x-3 bottom-3" method="GET" onclick="showDetails(${book.pk})">
                                    Details
                                </button>
                            </div>
                        </div>`;

                    container.append(bookElement);
                }
            }
        });

        // refreshBooks(); // Default = by rating
    </script>

    <!-- <div class="text-white my-5 mx-3 text-center">
        <p id="sorting" class="text-5xl text-center mb-0">Likes</p>
    </div>
    
    <div id="book_cards" class="text-white mx-3"></div>

    <script>
        // ajax get
        async function showLiked() {
            return fetch("{% url 'show_liked' %}").then((res) => res.json());
        }

        // sort by stars. if the stars is equal => ascending by title
        function compareByRating(a, b) {
            if (a.fields.stars == b.fields.stars) {
                return b.fields.title.localeCompare(a.fields.title);
            }
            return a.fields.stars - b.fields.stars;
        }

        async function showDetails(pk) {
            window.open("book-id-" + pk + "/", "_blank");
        }
    
        async function refreshBooks() {
            document.getElementById("book_cards").innerHTML = "";           
            let htmlString = `<div class="flex items-center justify-content-center container mx-auto my-8">
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5">`;

            const books = await showLiked();
            document.getElementById("sorting").innerHTML = `\n<p class="text-center mt-0 text-5xl mb-0">Leaderboard by Rating</p>`;
            books.sort(compareByRating);
            books.reverse();
            // show all likes
            for (let i = 0; i < books.length; i++) {
                book = books[i];
                htmlString += `\n
                <div class="rounded-xl shadow-lg bg-zinc-800 relative">
                    <div class="p-5 flex flex-col">
                        <img src="${book.fields.image_link}" alt="Cover for ${book.fields.title}" 
                        class="rounded-xl overflow-hidden w-52">
                        <p class="text-m md:text-m font-medium mt-3 text-white">
                            ${i+1}. ${book.fields.title}
                            <br>
                            -- ${book.fields.category}
                        </p>
                        <br>
                        <br>
                        <button class="text-center bg-gray-600 text-white py-2 rounded-lg font-semibold mt-4 hover:bg-gray-400 
                        focus:scale-95 transition-all duration-50 absolute inset-x-3 bottom-3" method="GET" onclick="showDetails(${book.pk})">
                            Details
                        </button>
                    </div>
                </div>`
            }
            htmlString += `\n</div></div>`;         
        }
        document.getElementById("book_cards").innerHTML = htmlString;

        refreshBooks(); // Default = by rating
    </script> -->
{% endblock content %}